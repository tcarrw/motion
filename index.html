<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motion Â· Flow Key</title>
<link rel="stylesheet" href="https://assets.plnt.earth/colors-daynight.css">
<style>
:root{
  --emerald:#00ffbf;
  --violet:#b88bff;
  --bg-day:radial-gradient(circle at 50% 0%,#ffffff 0%,#eafaf3 90%);
  --bg-night:radial-gradient(circle at 50% 10%,#0a0a12 0%,#060608 100%);
}
body{
  margin:0;padding:0;
  background:var(--bg-day);
  overflow:hidden;
  font-family:"Helvetica Neue",sans-serif;
  color:#111;
  transition:background .8s,color .8s;
}
body.night{background:var(--bg-night);color:#d8f2e1;}
body.school{background:#1a140f;color:#fffaec;}
body.motion{background:var(--bg-night);color:#e0ffff;}
body.quietmoon{background:#0a0a1a;color:#d0d0ff;}

canvas{position:fixed;inset:0;width:100%;height:100%;display:block;}
#overlay{
  position:fixed;inset:0;
  background:#fff;
  display:flex;align-items:center;justify-content:center;
  z-index:1000;cursor:pointer;
  font-size:1.6rem;letter-spacing:.05em;
  transition:opacity 1s ease;
}
body.night #overlay{background:#000;color:#eee;}
#overlay.hidden{opacity:0;pointer-events:none;}
#mantra{
  position:fixed;bottom:2rem;left:50%;
  transform:translateX(-50%);
  font-size:1.1rem;opacity:.15;
  text-shadow:0 0 10px rgba(184,139,255,.5);
  white-space:nowrap;pointer-events:none;
}
#toGarlic{
  position:fixed;bottom:50%;left:50%;
  transform:translate(-50%,50%);
  font-size:1.3rem;opacity:0;
  background:none;border:none;color:var(--emerald);
  cursor:pointer;transition:opacity 1s;
}
#toGarlic.show{opacity:1;}
#toggleMode{
  position:fixed;top:1rem;right:1rem;
  background:none;border:none;font-size:1.4rem;cursor:pointer;color:inherit;z-index:900;
}
/* triangle switch */
#switchMap{
  position:fixed;bottom:1.2rem;left:1.2rem;width:110px;height:110px;
  cursor:pointer;z-index:900;opacity:.6;transition:opacity .3s;
}
#switchMap:hover{opacity:1;}
</style>
</head>
<body>

<canvas id="wave"></canvas>
<div id="overlay">Tap to Begin Flow</div>
<button id="toggleMode" title="Toggle Day/Night">ðŸŒ—</button>
<div id="mantra">Bevegelse lÃ¦rer stillhet Ã¥ svare.</div>
<button id="toGarlic">Translate to Garlic â† </button>

<!-- Kendyl triangle switch -->
<div id="switchMap" title="Switch or choose your key">
  <svg viewBox="0 0 200 200" width="100%" height="100%">
    <polygon points="100,10 10,190 190,190" fill="none" stroke="#fff" stroke-width="1"/>
    <text x="95" y="30" font-size="22" text-anchor="middle">ðŸª¶</text>
    <text x="45" y="180" font-size="22" text-anchor="middle">ðŸŒ™</text>
    <text x="155" y="180" font-size="22" text-anchor="middle">ðŸŒ€</text>
  </svg>
</div>

<audio id="motionTone" loop preload="auto" style="display:none;">
  <!-- <source src="https://assets.plnt.earth/audio/monique-128hz.mp3" type="audio/mpeg"> -->
</audio>

<script>
/* ---------- canvas motion ---------- */
const overlay=document.getElementById('overlay');
const canvas=document.getElementById('wave');
const ctx=canvas.getContext('2d');
let w,h,t=0;
function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight;}
window.addEventListener('resize',resize);resize();
function draw(){
  ctx.clearRect(0,0,w,h);
  const g=ctx.createLinearGradient(0,0,w,h);
  g.addColorStop(0,'#00ffbf');g.addColorStop(1,'#b88bff');
  ctx.strokeStyle=g;ctx.lineWidth=2.2;
  ctx.beginPath();
  for(let x=0;x<w;x++){
    const y=h/2+Math.sin((x/50)+(t/4))*60*Math.sin(t/10);
    ctx.lineTo(x,y);
  }
  ctx.stroke();t+=0.6;requestAnimationFrame(draw);
}

/* ---------- flow start ---------- */
overlay.addEventListener('click',()=>{
  overlay.classList.add('hidden');
  setTimeout(()=>overlay.remove(),1000);
  draw();
  const tone=document.getElementById('motionTone');
  const startAudio=()=>{tone.play().catch(()=>{});document.removeEventListener('click',startAudio);};
  document.addEventListener('click',startAudio);
  setTimeout(()=>document.getElementById('toGarlic').classList.add('show'),42000);
});

/* ---------- toggle day/night ---------- */
document.getElementById('toggleMode').addEventListener('click',()=>document.body.classList.toggle('night'));

/* ---------- garlic transition ---------- */
document.getElementById('toGarlic').addEventListener('click',()=>{
  try{
    localStorage.setItem('motionKey','true');
    localStorage.setItem('lastKeyGranted','motion');
  }catch(e){}
  location.href='https://garlic.plnt.earth';
});

/* ---------- Kendyl key sync ---------- */
(function(){
  const map=document.getElementById("switchMap");
  const mode=localStorage.kendylKey||"motion";
  document.body.classList.add(mode);
  map.onclick=e=>{
    const {offsetX:x,offsetY:y}=e;
    if(y<60)localStorage.kendylKey="school";
    else if(x<100)localStorage.kendylKey="quietmoon";
    else localStorage.kendylKey="motion";
    location.reload();
  };
})();
</script>
</body>
</html>
